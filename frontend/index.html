<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Mini</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(170deg, #f0fdfa, #ccfbf1);
        }

        @keyframes float {
            0% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-8px);
            }

            100% {
                transform: translateY(0px);
            }
        }

        #search-form {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, .1);
            border-left-color: #14b8a6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        .snippet strong {
            color: #0f766e;
            font-weight: 600;
        }
    </style>
</head>

<body class="font-sans antialiased text-gray-800 min-h-screen flex flex-col">

    <div class="container mx-auto p-4 md:p-8 max-w-3xl flex-grow">
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-teal-600 mb-2">Search Mini</h1>
            <p class="text-gray-500">Your Personal Web Search Engine</p>
        </header>

        <!-- Search Form -->
        <form id="search-form" class="mb-10">
            <div class="relative shadow-lg rounded-full">
                <input type="text" id="search-input" placeholder="Search the crawled web..."
                    class="w-full px-6 py-4 text-lg border-2 border-transparent rounded-full focus:outline-none focus:ring-4 focus:ring-teal-300 transition duration-300"
                    required>
                <button type="submit"
                    class="absolute top-0 right-0 mt-2 mr-2 px-5 py-3 bg-teal-600 text-white font-semibold rounded-full hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="h-5 w-5">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <span class="ml-2 hidden md:inline">Search</span>
                </button>
            </div>
        </form>

        <main id="results-container">
            <div id="status-message" class="text-center text-gray-500 py-8">
                <p>Enter a query to begin searching.</p>
            </div>
        </main>
    </div>

    <footer class="text-center p-4 text-gray-500 text-sm">Curiosity is a good thing, if you channel your energy in the right direction</footer>

    <script>
        // DOM Elements
        const searchForm = document.getElementById('search-form');
        const searchInput = document.getElementById('search-input');
        const resultsContainer = document.getElementById('results-container');

        const API_URL = 'http://127.0.0.1:5000/search';

        // --- Event Listener ---
        searchForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const query = searchInput.value.trim();
            if (!query) return;
            await performSearch(query);
        });

        // --- Functions ---
        async function performSearch(query) {
            showLoading('Searching...');
            try {
                const response = await fetch(`${API_URL}?q=${encodeURIComponent(query)}`);
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const data = await response.json();
                displayResults(data);
            } catch (error) {
                console.error('Search failed:', error);
                showError('Could not connect to the search engine. Is the backend running?');
            }
        }

        function showLoading(message = 'Loading...') {
            resultsContainer.innerHTML = `<div class="flex justify-center items-center flex-col py-10"><div class="spinner"></div><p class="mt-4 text-gray-600">${message}</p></div>`;
        }

        function showError(message) {
            resultsContainer.innerHTML = `<div class="text-center text-red-500 bg-red-100 p-4 rounded-lg"><p class="font-bold">An Error Occurred</p><p>${message}</p></div>`;
        }

        function displayResults(data) {
            resultsContainer.innerHTML = '';
            const summary = document.createElement('p');
            summary.className = 'text-gray-600 mb-6';
            summary.textContent = `Found ${data.count} results for "${data.query}".`;
            resultsContainer.appendChild(summary);

            if (data.count === 0) {
                resultsContainer.innerHTML += `<div class="text-center text-gray-500"><p>No results found.</p></div>`;
                return;
            }

            data.results.forEach(result => {
                const resultElement = document.createElement('div');
                resultElement.className = 'bg-white p-5 mb-4 rounded-lg border shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all';

                resultElement.innerHTML = `
                    <h3 class="text-xl font-semibold text-teal-700 mb-1">
                        <a href="${result.id}" target="_blank" rel="noopener noreferrer" class="hover:underline">${truncateUrl(result.id)}</a>
                    </h3>
                    <a href="${result.id}" target="_blank" rel="noopener noreferrer" class="text-green-600 text-sm hover:underline break-all">${result.id}</a>
                    <p class="text-gray-600 mt-2 snippet">${result.snippet}</p>
                    <p class="text-gray-500 mt-2 text-right">Relevance Score: <span class="font-medium">${result.score}</span></p>
                `;
                resultsContainer.appendChild(resultElement);
            });
        }

        function truncateUrl(url) {
            try {
                const path = new URL(url).pathname;
                let title = decodeURIComponent(path.split('/').pop().replace(/_/g, ' '));
                return title.replace(/\.[^/.]+$/, "") || url;
            } catch (e) { return url; }
        }
    </script>
</body>

</html>